var dgram = require('dgram')
// var createSocket = dgram.createSocket
// var sid = 0
// dgram.createSocket = function () {
//   var s = createSocket.apply(dgram, arguments)
//   s._socketId = sid++
//   // try {
//   //   throw new Error()
//   // } catch (err) {
//   //   err.stack.split('\n').forEach(function (line) {
//   //     console.log(s._socketId, line)
//   //   })
//   // }

//   // if (s._socketId === 2) throw new Error('blah')
//   return s
// }

var Client = require('./symmetric')

var aPort = 12345
var bPort = 54321
var a = new Client(aPort)
var b = new Client(bPort)

b.on('data', function (data) {
  console.log('b got', data.toString())
})

a.on('data', function (data) {
  console.log('a got', data.toString())
  a.close()
  b.close()
})

a.connect(bPort)
setTimeout(function () {
  a.send('hey')
  b.connect(aPort)
  b.send('yo')
}, 200)

// setInterval(function () {
//   // console.log(cxns.map(function(c) {return c.socket._socketId}))
//   // cxns.forEach(function (c) { c.destroy() })
//   console.log(process._getActiveHandles().map(function (h) {
//     return h._socketId
//   }))
// }, 2000).unref()
