var utp = require('../index');
var assert = require('assert');
var msgs = [
  '1', '2', '3'
]

utp.createServer(function(socket) {
  var sIdx = 0
  socket.on('data', function(data) {
    assert(data.toString() === msgs[sIdx]);
    socket.write(msgs[sIdx]);
    sIdx++
  });
}).listen(53454);

var cIdx = 0
var socket = utp.connect(53454);
msgs.forEach(socket.write, socket)
socket.on('data', function(data) {
  assert(data.toString() === msgs[cIdx]);
  if (++cIdx === msgs.length) {
    process.exit(0);
  }
});

setTimeout(process.exit.bind(process, 1), 15000);
