var utp = require('../');
var assert = require('assert');

for (var i = 1; i < 1000; i++) {
  run(i)
}

setInterval(function () {
  var count = 0
  for (var i = 0; i < 0xffff; i++) {
    if (utp.RECV_IDS.get(i)) count++
  }
  console.log('ids', count)
}, 200).unref()

function run (port) {
  var saw = []
  setTimeout(function () {
    var s = utp.connect(port)
    s.socket.on('listening', function () {
      assert(saw.indexOf(s._recvId) === -1)
    })

    setTimeout(function () {
      s.end()
    }, 10)
  }, port)
}
